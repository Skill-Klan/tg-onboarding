#!/bin/bash

echo "üåê –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑–æ–≤–Ω—ñ—à–Ω—å–æ—ó –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ Web App..."

# –û—Ç—Ä–∏–º—É—î–º–æ –ø—É–±–ª—ñ—á–Ω—É IP
PUBLIC_IP=$(curl -s --max-time 5 ifconfig.me 2>/dev/null)

if [ -z "$PUBLIC_IP" ]; then
    echo "‚ùå –ü–æ–º–∏–ª–∫–∞: –ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø—É–±–ª—ñ—á–Ω—É IP"
    exit 1
fi

echo "‚úÖ –ü—É–±–ª—ñ—á–Ω–∞ IP: $PUBLIC_IP"
echo "üîç –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ –ø–æ—Ä—Ç—É 3000..."

# –¢–µ—Å—Ç—É—î–º–æ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ –∑–æ–≤–Ω—ñ—à–Ω—å–æ—ó —Ç–æ—á–∫–∏
if timeout 5 bash -c "</dev/tcp/$PUBLIC_IP/3000" 2>/dev/null; then
    echo "‚úÖ –ü–æ—Ä—Ç 3000 –¥–æ—Å—Ç—É–ø–Ω–∏–π –∑–∑–æ–≤–Ω—ñ!"
    echo "üåê Web App –ø–æ–≤–∏–Ω–µ–Ω –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –≤ Telegram"
    
    # –¢–µ—Å—Ç—É—î–º–æ HTTP –≤—ñ–¥–ø–æ–≤—ñ–¥—å
    echo "üì° –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è HTTP –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ..."
    HTTP_RESPONSE=$(curl -s --max-time 10 "http://$PUBLIC_IP:3000" | head -5)
    
    if [ ! -z "$HTTP_RESPONSE" ]; then
        echo "‚úÖ HTTP –≤—ñ–¥–ø–æ–≤—ñ–¥—å –æ—Ç—Ä–∏–º–∞–Ω–æ:"
        echo "$HTTP_RESPONSE"
        echo ""
        echo "üéâ Web App –≥–æ—Ç–æ–≤–∏–π –¥–æ —Ä–æ–±–æ—Ç–∏!"
        echo "üì± –ü—Ä–æ—Ç–µ—Å—Ç—É–π—Ç–µ –≤ Telegram: –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É 'üìö FAQ'"
    else
        echo "‚ùå HTTP –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–µ –æ—Ç—Ä–∏–º–∞–Ω–æ"
        echo "üí° –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω–∏–π: npm start"
    fi
    
else
    echo "‚ùå –ü–æ—Ä—Ç 3000 –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π –∑–∑–æ–≤–Ω—ñ"
    echo ""
    echo "üîß –ü–æ—Ç—Ä—ñ–±–Ω–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç—É –Ω–∞ —Ä–æ—É—Ç–µ—Ä—ñ:"
    echo ""
    echo "1Ô∏è‚É£ –í—ñ–¥–∫—Ä–∏–π—Ç–µ —Ä–æ—É—Ç–µ—Ä: http://192.168.0.1"
    echo "2Ô∏è‚É£ –ó–Ω–∞–π–¥—ñ—Ç—å —Ä–æ–∑–¥—ñ–ª 'Port Forwarding' –∞–±–æ '–ü—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç—ñ–≤'"
    echo "3Ô∏è‚É£ –î–æ–¥–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª–æ:"
    echo "   üåê Service Name: Telegram Bot"
    echo "   üîó Protocol: TCP"
    echo "   üö™ External Port: 3000"
    echo "   üè† Internal Port: 3000"
    echo "   üíª Internal IP: 192.168.0.110"
    echo "   ‚úÖ Status: Enabled"
    echo ""
    echo "4Ô∏è‚É£ –ó–±–µ—Ä–µ–∂—ñ—Ç—å –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è"
    echo "5Ô∏è‚É£ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å —Å–µ—Ä–≤–µ—Ä: npm start"
    echo "6Ô∏è‚É£ –ó–∞–ø—É—Å—Ç—ñ—Ç—å —Ü–µ–π —Ç–µ—Å—Ç –∑–Ω–æ–≤—É: ./test_external_access.sh"
    echo ""
    echo "üìñ –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è: ROUTER_SETUP.md"
fi

echo ""
echo "üìä –ü–æ—Ç–æ—á–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è:"
echo "   –õ–æ–∫–∞–ª—å–Ω–∞ IP: 192.168.0.110"
echo "   –ü—É–±–ª—ñ—á–Ω–∞ IP: $PUBLIC_IP"
echo "   –ü–æ—Ä—Ç: 3000"
echo "   Web App URL: http://$PUBLIC_IP:3000/faq.html"
