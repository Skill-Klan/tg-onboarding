# üîß SSH Troubleshooting –¥–ª—è GitHub Actions

## ‚ùå –ü–æ–º–∏–ª–∫–∞: "Add Server to Known Hosts failed"

### üö® **–©–æ —Å—Ç–∞–ª–æ—Å—è:**
GitHub Actions –Ω–µ –º–æ–∂–µ –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ –≤–∞—à–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –¥–æ known_hosts.

### üîç **–ú–æ–∂–ª–∏–≤—ñ –ø—Ä–∏—á–∏–Ω–∏:**

#### 1. **–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π –∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É**
–í–∞—à IP `192.168.0.110` - —Ü–µ –ª–æ–∫–∞–ª—å–Ω–∏–π IP, –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π –∑ GitHub Actions.

**–†—ñ—à–µ–Ω–Ω—è:**
```bash
# –î—ñ–∑–Ω–∞—Ç–∏—Å—è –∑–æ–≤–Ω—ñ—à–Ω—ñ–π IP
curl ifconfig.me
# –ê–±–æ
curl ipinfo.io/ip

# –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü–µ–π IP –≤ GitHub Secret HOST
```

#### 2. **Firewall –±–ª–æ–∫—É—î –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è**
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ SSH –≤—ñ–¥–∫—Ä–∏—Ç–∏–π
sudo ufw status
sudo ufw allow 22

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ SSH —Å–µ—Ä–≤—ñ—Å
sudo systemctl status ssh
sudo systemctl enable ssh
sudo systemctl start ssh
```

#### 3. **SSH –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –¥–ª—è –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –ø—ñ–¥–∫–ª—é—á–µ–Ω—å**
```bash
# –í—ñ–¥—Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ SSH –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é
sudo nano /etc/ssh/sshd_config

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏/–¥–æ–¥–∞—Ç–∏:
PermitRootLogin no
PasswordAuthentication no
PubkeyAuthentication yes
Port 22

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ SSH
sudo systemctl restart ssh
```

## üõ†Ô∏è **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ñ —Ä—ñ—à–µ–Ω–Ω—è:**

### –í–∞—Ä—ñ–∞–Ω—Ç 1: **–õ–æ–∫–∞–ª—å–Ω–∏–π –¥–µ–ø–ª–æ–π**
–Ø–∫—â–æ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–Ω–∏–π —Ç—ñ–ª—å–∫–∏ –ª–æ–∫–∞–ª—å–Ω–æ:
```bash
# –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–∏–π —Å–∫—Ä–∏–ø—Ç –∑–∞–º—ñ—Å—Ç—å GitHub Actions
BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω ./deploy.sh deploy
```

### –í–∞—Ä—ñ–∞–Ω—Ç 2: **ngrok –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è**
```bash
# –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ ngrok
sudo snap install ngrok

# –í—ñ–¥–∫—Ä–∏—Ç–∏ SSH —Ç—É–Ω–µ–ª—å
ngrok tcp 22

# –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ ngrok URL –≤ GitHub Secret HOST
# –ù–∞–ø—Ä–∏–∫–ª–∞–¥: 0.tcp.ngrok.io:12345
```

### –í–∞—Ä—ñ–∞–Ω—Ç 3: **VPN –∞–±–æ —Ö–º–∞—Ä–Ω–∏–π —Å–µ—Ä–≤–µ—Ä**
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ VPS (DigitalOcean, AWS, etc.)
- –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ VPN –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

## ‚úÖ **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ SSH –¥–æ—Å—Ç—É–ø—É**

### –ó –ª–æ–∫–∞–ª—å–Ω–æ—ó –º–∞—à–∏–Ω–∏:
```bash
# –¢–µ—Å—Ç –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
ssh -i ~/.ssh/github_deploy roman@192.168.0.110 'echo OK'

# –¢–µ—Å—Ç –∑ –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ IP
ssh -i ~/.ssh/github_deploy roman@–≤–∞—à_–∑–æ–≤–Ω—ñ—à–Ω—ñ–π_ip 'echo OK'
```

### –ó GitHub Actions (—Å–∏–º—É–ª—è—Ü—ñ—è):
```bash
# –¢–µ—Å—Ç ssh-keyscan
ssh-keyscan -H –≤–∞—à_ip

# –ú–∞—î –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á —Å–µ—Ä–≤–µ—Ä–∞
```

## üîÑ **–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –≤ deploy.yml**

–§–∞–π–ª –≤–∂–µ –æ–Ω–æ–≤–ª–µ–Ω–æ –∑:
- ‚úÖ –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ ssh-keyscan
- ‚úÖ StrictHostKeyChecking=no —è–∫ fallback
- ‚úÖ –¢–µ—Å—Ç SSH –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ—î–º
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏

## üìã **–®–≤–∏–¥–∫–µ —Ä—ñ—à–µ–Ω–Ω—è:**

1. **–î—ñ–∑–Ω–∞—Ç–∏—Å—è –∑–æ–≤–Ω—ñ—à–Ω—ñ–π IP:**
   ```bash
   curl ifconfig.me
   ```

2. **–û–Ω–æ–≤–∏—Ç–∏ GitHub Secret HOST** –Ω–∞ –∑–æ–≤–Ω—ñ—à–Ω—ñ–π IP

3. **–ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è —â–æ SSH –¥–æ—Å—Ç—É–ø–Ω–∏–π:**
   ```bash
   sudo ufw allow 22
   sudo systemctl enable ssh
   ```

4. **–ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ —â–µ —Ä–∞–∑** GitHub Actions

## üÜò **–Ø–∫—â–æ –Ω—ñ—á–æ–≥–æ –Ω–µ –¥–æ–ø–æ–º–∞–≥–∞—î:**

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ **–ª–æ–∫–∞–ª—å–Ω–∏–π –¥–µ–ø–ª–æ–π** –∑–∞–º—ñ—Å—Ç—å GitHub Actions:
```bash
BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω ./deploy.sh deploy
```

–¶–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ –Ω–∞–≤—ñ—Ç—å –±–µ–∑ –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ —Å–µ—Ä–≤–µ—Ä–∞!
